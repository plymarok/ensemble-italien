<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>R√©visions d‚Äôitalien ‚Äî 1 page</title>
<style>
  :root{
    --bg:#0f172a; --panel:#0b1426; --text:#e2e8f0; --muted:#94a3b8;
    --brand:#38bdf8; --brand2:#a78bfa; --card:#16223a; --card2:#1e2a44;
    --radius:14px; --shadow:0 8px 28px rgba(0,0,0,.35);
  }
  body{margin:0;background:var(--bg);color:var(--text);
       font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
  header{position:sticky;top:0;z-index:10;color:#fff;
         background:linear-gradient(90deg,var(--brand),var(--brand2));
         padding:16px 12px;text-align:center;font-weight:800;letter-spacing:.3px}
  .bar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;
       padding:10px;background:#0b1426;border-bottom:1px solid rgba(148,163,184,.22)}
  .chip{background:var(--card);border:1px solid rgba(148,163,184,.3);color:var(--text);
        border-radius:999px;padding:8px 12px;text-decoration:none;box-shadow:var(--shadow)}
  .controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;padding:10px}
  .btn{background:var(--brand);color:#00131c;border:none;border-radius:12px;
       padding:8px 12px;font-weight:700;cursor:pointer;box-shadow:var(--shadow)}
  .btn.ghost{background:transparent;color:var(--text);
             border:1px solid rgba(148,163,184,.35)}
  main{max-width:1100px;margin:16px auto;padding:0 12px}
  h2{margin:26px 0 10px;color:var(--brand)}
  .card{background:var(--card);border:1px solid rgba(148,163,184,.25);
        border-radius:var(--radius);box-shadow:var(--shadow);
        padding:12px 14px;margin:10px 0;display:flex;align-items:center;justify-content:space-between;gap:8px}
  .row{display:flex;align-items:center;justify-content:space-between;gap:8px;margin:6px 0}
  .grid{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(270px,1fr))}
  .text{font-size:1.05rem}
  .fr{opacity:.95}
  .hide-fr .fr{display:none}
  .note{max-width:1100px;margin:10px auto 0;padding:8px 12px;
        background:#fff3cd;color:#1f2937;border:1px solid #facc15;border-radius:12px}
  .search{display:flex;gap:8px;align-items:center;margin:8px 0 14px}
  .search input{flex:1;min-width:220px;background:var(--panel);color:var(--text);
                border:1px solid rgba(148,163,184,.35);border-radius:12px;padding:10px 12px}
  .small{color:var(--muted);font-size:.95rem}
  #diag{display:none;position:sticky;top:0;z-index:20;background:#fee2e2;color:#7f1d1d;
        border-bottom:1px solid #fecaca;padding:8px 10px;white-space:pre-wrap}
</style>
</head>
<body>
<header>üìò R√©visions d‚Äôitalien ‚Äî 1 page</header>

<div id="diag"></div>

<div class="bar">
  <a class="chip" href="#verbes">Verbes</a>
  <a class="chip" href="#vocab">Vocabulaire</a>
  <a class="chip" href="#passatempi">Passatempi</a>
</div>

<div class="controls">
  <button id="toggle-fr" class="btn">Masquer FR</button>
  <button id="scroll-top" class="btn ghost">Haut ‚¨ÜÔ∏è</button>
</div>

<main id="app">
  <div class="note small">üîä Appuie sur un bouton pour entendre l‚Äôitalien.  
  Sur iPhone, d√©sactive le mode silencieux.</div>

  <section id="verbes">
    <h2>Verbes essentiels</h2>
    <p class="small">FARE, POTERE, ANDARE, CHIAMARSI, ESSERE, AVERE + mod√®les PARLARE (&nbsp;-ARE&nbsp;) et SCRIVERE (&nbsp;-ERE&nbsp;).</p>
    <div class="search">
      <input id="search-verbes" placeholder="Filtrer un verbe/une forme‚Ä¶" />
      <button class="btn ghost" onclick="this.previousElementSibling.value=''; renderVerbes();">Effacer</button>
    </div>
    <div id="verbes-list"></div>
  </section>

  <section id="vocab">
    <h2>Vocabulaire utile</h2>
    <div class="search">
      <input id="search-vocab" placeholder="Filtrer une expression‚Ä¶" />
      <button class="btn ghost" onclick="this.previousElementSibling.value=''; renderVocab();">Effacer</button>
    </div>
    <div id="vocab-list"></div>
  </section>

  <section id="passatempi">
    <h2>I passatempi (loisirs)</h2>
    <div class="search">
      <input id="search-pass" placeholder="Filtrer un passe-temps‚Ä¶" />
      <button class="btn ghost" onclick="this.previousElementSibling.value=''; renderPassatempi();">Effacer</button>
    </div>
    <div id="pass-list" class="grid"></div>
  </section>
</main>

<script>
/* ========================= Donn√©es inline ========================= */
const VERBS = [
  {verb:'FARE', tr:'faire', forms:[
    ['io faccio','je fais'],['tu fai','tu fais'],['lui/lei fa','il/elle fait'],
    ['noi facciamo','nous faisons'],['voi fate','vous faites'],['loro fanno','ils font']
  ]},
  {verb:'POTERE', tr:'pouvoir', forms:[
    ['io posso','je peux'],['tu puoi','tu peux'],['lui/lei pu√≤','il/elle peut'],
    ['noi possiamo','nous pouvons'],['voi potete','vous pouvez'],['loro possono','ils peuvent']
  ]},
  {verb:'ANDARE', tr:'aller', forms:[
    ['io vado','je vais'],['tu vai','tu vas'],['lui/lei va','il/elle va'],
    ['noi andiamo','nous allons'],['voi andate','vous allez'],['loro vanno','ils vont']
  ]},
  {verb:'CHIAMARSI', tr:"s'appeler", forms:[
    ['mi chiamo','je m‚Äôappelle'],['ti chiami','tu t‚Äôappelles'],['si chiama','il/elle s‚Äôappelle'],
    ['ci chiamiamo','nous nous appelons'],['vi chiamate','vous vous appelez'],['si chiamano','ils s‚Äôappellent']
  ]},
  {verb:'ESSERE', tr:'√™tre', forms:[
    ['io sono','je suis'],['tu sei','tu es'],['lui/lei √®','il/elle est'],
    ['noi siamo','nous sommes'],['voi siete','vous √™tes'],['loro sono','ils sont']
  ]},
  {verb:'AVERE', tr:'avoir', forms:[
    ['io ho','j‚Äôai'],['tu hai','tu as'],['lui/lei ha','il/elle a'],
    ['noi abbiamo','nous avons'],['voi avete','vous avez'],['loro hanno','ils ont']
  ]},
  {verb:'PARLARE (mod√®le -ARE)', tr:'parler', forms:[
    ['io parlo','je parle'],['tu parli','tu parles'],['lui/lei parla','il/elle parle'],
    ['noi parliamo','nous parlons'],['voi parlate','vous parlez'],['loro parlano','ils parlent']
  ]},
  {verb:'SCRIVERE (mod√®le -ERE)', tr:'√©crire', forms:[
    ['io scrivo','j‚Äô√©cris'],['tu scrivi','tu √©cris'],['lui/lei scrive','il/elle √©crit'],
    ['noi scriviamo','nous √©crivons'],['voi scrivete','vous √©crivez'],['loro scrivono','ils √©crivent']
  ]}
];

const VOCAB_SECTIONS = [
  {title:'Formules de politesse', items:[
    ['Per favore','S‚Äôil vous pla√Æt'],['Grazie','Merci'],
    ['Prego','De rien'],['Scusa / Scusi','Pardon']
  ]},
  {title:'Manifester son incompr√©hension', items:[
    ['Non ho capito / sentito','Je n‚Äôai pas compris / entendu'],
    ['Pu√≤ / puoi ripetere?','Pouvez-vous / peux-tu r√©p√©ter ?'],
    ['Non lo so','Je ne sais pas'],
    ['Cosa significa?','Que signifie ?']
  ]},
  {title:'Demander du mat√©riel', items:[
    ['Posso avere una colla?','Je peux avoir une colle ?'],
    ['Posso avere un fazzoletto?','Je peux avoir un mouchoir ?'],
    ['Posso avere una penna?','Je peux avoir un stylo ?']
  ]},
  {title:'Dire qu‚Äôon a termin√©', items:[
    ['Ho finito!','J‚Äôai termin√© !'],
    ['Fatto!','C‚Äôest fait !'],
    ['Posso fare qualcos‚Äôaltro?','Je peux faire autre chose ?']
  ]},
  {title:'S‚Äôexcuser', items:[
    ['Non ho fatto i compiti','Je n‚Äôai pas fait les devoirs'],
    ['Ho dimenticato il quaderno','J‚Äôai oubli√© le cahier'],
    ['Scusa per il ritardo','D√©sol√©(e) pour le retard']
  ]},
  {title:'Pronoms interrogatifs', items:[
    ['Perch√©','Pourquoi'],['Quando','Quand'],['Chi','Qui'],['Dove','O√π'],
    ['Come','Comment'],['Che cosa','Quoi'],['Quanto','Combien'],['Quale','Quel(les)']
  ]},
  {title:'Saisons + expressions', items:[
    ['La primavera','Le printemps'],['L‚Äôestate','L‚Äô√©t√©'],['L‚Äôautunno','L‚Äôautomne'],['L‚Äôinverno','L‚Äôhiver'],
    ['Andare in montagna','Aller √† la montagne'],['Andare al mare','Aller √† la mer']
  ]}
];

const PASSATEMPI = [
  ['Fare yoga','Faire du yoga üßò'],['Pescare','P√™cher üé£'],['Suonare la chitarra','Jouer de la guitare üé∏'],
  ['Cantare','Chanter üé§'],['Giocare a calcio','Jouer au foot ‚öΩ'],['Andare in bici','Faire du v√©lo üö≤'],
  ['Giocare a basket','Jouer au basket üèÄ'],['Giocare a pallavolo','Jouer au volley üèê'],
  ['Andare a teatro','Aller au th√©√¢tre üé≠'],['Dipingere','Peindre üé®'],
  ['Andare al cinema','Aller au cin√©ma üé¨'],['Ascoltare la musica','√âcouter la musique üìª'],
  ['Giocare ai videogiochi','Jouer aux jeux vid√©o üéÆ'],['Leggere','Lire üìñ'],
  ['Viaggiare','Voyager ‚úàÔ∏è'],['Giocare a cricket','Jouer au cricket üèè']
];

/* ====================== Rendu (1 seule page) ====================== */
const $ = s=>document.querySelector(s);

function renderVerbes(){
  const q = ($('#search-verbes').value||'').toLowerCase();
  const wrap = $('#verbes-list'); wrap.innerHTML='';
  VERBS.forEach(v=>{
    const ok = !q || v.verb.toLowerCase().includes(q) || v.tr.toLowerCase().includes(q) ||
      v.forms.some(f => f[0].toLowerCase().includes(q) || f[1].toLowerCase().includes(q));
    if(!ok) return;
    const card = document.createElement('div'); card.className='card'; card.innerHTML =
      `<div class="text"><b>${v.verb}</b> ‚Äî <span class="fr">${v.tr}</span></div>`;
    const details = document.createElement('div'); details.className='details';
    v.forms.forEach(f=>{
      const row = document.createElement('div'); row.className='row';
      row.innerHTML = `<span>${f[0]} ‚Äî <span class="fr">${f[1]}</span></span>
                       <button class="btn" data-it="${f[0].replace(/"/g,'&quot;')}">üîä</button>`;
      details.appendChild(row);
    });
    const box = document.createElement('div'); box.style.width='100%';
    box.appendChild(card); box.appendChild(details);
    wrap.appendChild(box);
  });
}

function renderVocab(){
  const q = ($('#search-vocab').value||'').toLowerCase();
  const wrap = $('#vocab-list'); wrap.innerHTML='';
  VOCAB_SECTIONS.forEach(sec=>{
    const items = sec.items.filter(it =>
      !q || it[0].toLowerCase().includes(q) || it[1].toLowerCase().includes(q)
    );
    if(!items.length) return;
    const h = document.createElement('h3'); h.textContent = sec.title; h.style.margin='14px 2px 8px'; wrap.appendChild(h);
    items.forEach(it=>{
      const card = document.createElement('div'); card.className='card';
      card.innerHTML = `<div class="text">${it[0]} ‚Äî <span class="fr">${it[1]}</span></div>
                        <button class="btn" data-it="${it[0].replace(/"/g,'&quot;')}">üîä</button>`;
      wrap.appendChild(card);
    });
  });
}

function renderPassatempi(){
  const q = ($('#search-pass').value||'').toLowerCase();
  const grid = $('#pass-list'); grid.innerHTML='';
  PASSATEMPI.filter(it => !q || it[0].toLowerCase().includes(q) || it[1].toLowerCase().includes(q))
            .forEach(it=>{
              const card = document.createElement('div'); card.className='card';
              card.innerHTML = `<div class="text">${it[0]} ‚Äî <span class="fr">${it[1]}</span></div>
                                <button class="btn" data-it="${it[0].replace(/"/g,'&quot;')}">üîä</button>`;
              grid.appendChild(card);
            });
}

/* ============================ Audio robuste ============================ */
// 1) Web Speech (priorit√©). 2) Fallback audio distant (Google TTS).
const hasWS = ('speechSynthesis' in window) && ('SpeechSynthesisUtterance' in window);
let itVoice = null;
function pickVoice(){
  try{
    const vs = speechSynthesis.getVoices() || [];
    itVoice = null;
    for (let i=0;i<vs.length;i++){
      if(/^it(\-|_|$)/i.test(vs[i].lang) || /ital/i.test(vs[i].name)){ itVoice = vs[i]; break; }
    }
  }catch(e){ itVoice = null; }
}
if(hasWS){
  try{ speechSynthesis.onvoiceschanged = pickVoice; setTimeout(pickVoice,0); }catch(e){}
}
const audioEl = new Audio(); audioEl.setAttribute('playsinline',''); audioEl.preload = 'none';
function gTTS(text, lang){ return 'https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&tl='+(lang||'it')+'&q='+encodeURIComponent(text); }

function speak(text){
  if(!text) return;
  // essaie WebSpeech; si onStart ne vient pas rapidement, bascule sur <audio>.
  if(hasWS){
    let started = false, timedOut = false;
    const u = new SpeechSynthesisUtterance(text);
    if(itVoice){ u.voice = itVoice; u.lang = itVoice.lang; } else { u.lang = 'it-IT'; }
    u.rate = 1.0; u.pitch = 1.0;
    u.onstart = ()=>{ started = true; };
    try{ speechSynthesis.speak(u); }catch(e){}
    setTimeout(()=>{
      timedOut = true;
      if(!started){ // fallback fiable smartphone/webview
        audioEl.src = gTTS(text,'it');
        audioEl.play().catch(()=>{});
      }
    }, 300);
    return;
  }
  // Pas de WebSpeech ‚Üí direct <audio>
  audioEl.src = gTTS(text,'it');
  audioEl.play().catch(()=>{});
}

/* =========================== Interactions UI =========================== */
document.addEventListener('pointerdown', e=>{
  let n=e.target;
  while(n && n!==document){
    if(n.tagName==='BUTTON' && n.hasAttribute('data-it')){
      speak(n.getAttribute('data-it'));
      break;
    }
    n=n.parentNode;
  }
}, {passive:true});

document.getElementById('toggle-fr').onclick = function(){
  document.body.classList.toggle('hide-fr');
  this.textContent = document.body.classList.contains('hide-fr') ? 'Afficher FR' : 'Masquer FR';
};
document.getElementById('scroll-top').onclick = ()=>window.scrollTo({top:0,behavior:'smooth'});

/* ============================== Diagnostic ============================= */
const diag = document.getElementById('diag');
function showDiag(msg){
  diag.style.display='block';
  diag.textContent += (diag.textContent? '\n' : '') + msg;
}
window.addEventListener('error', e=>{
  showDiag('‚ùå '+(e.message||'Erreur JS')+(e.filename? ' ‚Äî '+e.filename:'')+(e.lineno? ' (ligne '+e.lineno+')':''));});
window.addEventListener('unhandledrejection', e=>{
  showDiag('‚ùå Promise: '+(e.reason && e.reason.message ? e.reason.message : e.reason));});

/* =============================== D√©marrage ============================== */
renderVerbes(); renderVocab(); renderPassatempi();
</script>
</body>
</html>
